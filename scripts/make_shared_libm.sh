#!/bin/bash
#
# Build glibc and generate a sysroot for clang to cross-compile lind programs
#
# IMPORTANT NOTES:
# - call from source code repository root directory
# - expects `clang` and other llvm binaries on $PATH
# - expects GLIBC source in $PWD/src/glibc
#
set -e

CC="clang"
GLIBC="$PWD/src/glibc"
BUILD="$GLIBC/build"
SYSROOT="$GLIBC/sysroot"
SYSROOT_ARCHIVE="$SYSROOT/lib/wasm32-wasi/libc.a"

wasm-ld \
    --import-memory \
    --shared-memory \
    --export-dynamic \
    --experimental-pic \
    --unresolved-symbols=import-dynamic \
    -shared \
    --whole-archive \
    "$SYSROOT/lib/wasm32-wasi/libm_pic.a" \
    --no-whole-archive \
    --export-if-defined=_LIB_VERSION \
    --export-if-defined=__acos_finite \
    --export-if-defined=__acosf_finite \
    --export-if-defined=__acosh_finite \
    --export-if-defined=__acoshf_finite \
    --export-if-defined=__acoshl_finite \
    --export-if-defined=__acosl_finite \
    --export-if-defined=__asin_finite \
    --export-if-defined=__asinf_finite \
    --export-if-defined=__asinl_finite \
    --export-if-defined=__atan2_finite \
    --export-if-defined=__atan2f_finite \
    --export-if-defined=__atan2l_finite \
    --export-if-defined=__atanh_finite \
    --export-if-defined=__atanhf_finite \
    --export-if-defined=__atanhl_finite \
    --export-if-defined=__clog10 \
    --export-if-defined=__clog10f \
    --export-if-defined=__clog10l \
    --export-if-defined=__cosh_finite \
    --export-if-defined=__coshf_finite \
    --export-if-defined=__coshl_finite \
    --export-if-defined=__exp10_finite \
    --export-if-defined=__exp10f_finite \
    --export-if-defined=__exp10l_finite \
    --export-if-defined=__exp2_finite \
    --export-if-defined=__exp2f_finite \
    --export-if-defined=__exp2l_finite \
    --export-if-defined=__exp_finite \
    --export-if-defined=__expf_finite \
    --export-if-defined=__expl_finite \
    --export-if-defined=__finite \
    --export-if-defined=__finitef \
    --export-if-defined=__finitel \
    --export-if-defined=__fmod_finite \
    --export-if-defined=__fmodf_finite \
    --export-if-defined=__fmodl_finite \
    --export-if-defined=__fpclassify \
    --export-if-defined=__fpclassifyf \
    --export-if-defined=__fpclassifyl \
    --export-if-defined=__fpu_control \
    --export-if-defined=__gamma_r_finite \
    --export-if-defined=__gammaf_r_finite \
    --export-if-defined=__gammal_r_finite \
    --export-if-defined=__hypot_finite \
    --export-if-defined=__hypotf_finite \
    --export-if-defined=__hypotl_finite \
    --export-if-defined=__iscanonicall \
    --export-if-defined=__iseqsig \
    --export-if-defined=__iseqsigf \
    --export-if-defined=__iseqsigl \
    --export-if-defined=__isinf \
    --export-if-defined=__isinff \
    --export-if-defined=__isinfl \
    --export-if-defined=__isnan \
    --export-if-defined=__isnanf \
    --export-if-defined=__isnanl \
    --export-if-defined=__issignaling \
    --export-if-defined=__issignalingf \
    --export-if-defined=__issignalingl \
    --export-if-defined=__j0_finite \
    --export-if-defined=__j0f_finite \
    --export-if-defined=__j0l_finite \
    --export-if-defined=__j1_finite \
    --export-if-defined=__j1f_finite \
    --export-if-defined=__j1l_finite \
    --export-if-defined=__jn_finite \
    --export-if-defined=__jnf_finite \
    --export-if-defined=__jnl_finite \
    --export-if-defined=__lgamma_r_finite \
    --export-if-defined=__lgammaf_r_finite \
    --export-if-defined=__lgammal_r_finite \
    --export-if-defined=__log10_finite \
    --export-if-defined=__log10f_finite \
    --export-if-defined=__log10l_finite \
    --export-if-defined=__log2_finite \
    --export-if-defined=__log2f_finite \
    --export-if-defined=__log2l_finite \
    --export-if-defined=__log_finite \
    --export-if-defined=__logf_finite \
    --export-if-defined=__logl_finite \
    --export-if-defined=__pow_finite \
    --export-if-defined=__powf_finite \
    --export-if-defined=__powl_finite \
    --export-if-defined=__remainder_finite \
    --export-if-defined=__remainderf_finite \
    --export-if-defined=__remainderl_finite \
    --export-if-defined=__scalb_finite \
    --export-if-defined=__scalbf_finite \
    --export-if-defined=__scalbl_finite \
    --export-if-defined=__signbit \
    --export-if-defined=__signbitf \
    --export-if-defined=__signbitl \
    --export-if-defined=__signgam \
    --export-if-defined=__sinh_finite \
    --export-if-defined=__sinhf_finite \
    --export-if-defined=__sinhl_finite \
    --export-if-defined=__sqrt_finite \
    --export-if-defined=__sqrtf_finite \
    --export-if-defined=__sqrtl_finite \
    --export-if-defined=__y0_finite \
    --export-if-defined=__y0f_finite \
    --export-if-defined=__y0l_finite \
    --export-if-defined=__y1_finite \
    --export-if-defined=__y1f_finite \
    --export-if-defined=__y1l_finite \
    --export-if-defined=__yn_finite \
    --export-if-defined=__ynf_finite \
    --export-if-defined=__ynl_finite \
    --export-if-defined=acos \
    --export-if-defined=acosf \
    --export-if-defined=acosf32 \
    --export-if-defined=acosf32x \
    --export-if-defined=acosf64 \
    --export-if-defined=acosf64x \
    --export-if-defined=acosh \
    --export-if-defined=acoshf \
    --export-if-defined=acoshf32 \
    --export-if-defined=acoshf32x \
    --export-if-defined=acoshf64 \
    --export-if-defined=acoshf64x \
    --export-if-defined=acoshl \
    --export-if-defined=acosl \
    --export-if-defined=asin \
    --export-if-defined=asinf \
    --export-if-defined=asinf32 \
    --export-if-defined=asinf32x \
    --export-if-defined=asinf64 \
    --export-if-defined=asinf64x \
    --export-if-defined=asinh \
    --export-if-defined=asinhf \
    --export-if-defined=asinhf32 \
    --export-if-defined=asinhf32x \
    --export-if-defined=asinhf64 \
    --export-if-defined=asinhf64x \
    --export-if-defined=asinhl \
    --export-if-defined=asinl \
    --export-if-defined=atan \
    --export-if-defined=atan2 \
    --export-if-defined=atan2f \
    --export-if-defined=atan2f32 \
    --export-if-defined=atan2f32x \
    --export-if-defined=atan2f64 \
    --export-if-defined=atan2f64x \
    --export-if-defined=atan2l \
    --export-if-defined=atanf \
    --export-if-defined=atanf32 \
    --export-if-defined=atanf32x \
    --export-if-defined=atanf64 \
    --export-if-defined=atanf64x \
    --export-if-defined=atanh \
    --export-if-defined=atanhf \
    --export-if-defined=atanhf32 \
    --export-if-defined=atanhf32x \
    --export-if-defined=atanhf64 \
    --export-if-defined=atanhf64x \
    --export-if-defined=atanhl \
    --export-if-defined=atanl \
    --export-if-defined=cabs \
    --export-if-defined=cabsf \
    --export-if-defined=cabsf32 \
    --export-if-defined=cabsf32x \
    --export-if-defined=cabsf64 \
    --export-if-defined=cabsf64x \
    --export-if-defined=cabsl \
    --export-if-defined=cacos \
    --export-if-defined=cacosf \
    --export-if-defined=cacosf32 \
    --export-if-defined=cacosf32x \
    --export-if-defined=cacosf64 \
    --export-if-defined=cacosf64x \
    --export-if-defined=cacosh \
    --export-if-defined=cacoshf \
    --export-if-defined=cacoshf32 \
    --export-if-defined=cacoshf32x \
    --export-if-defined=cacoshf64 \
    --export-if-defined=cacoshf64x \
    --export-if-defined=cacoshl \
    --export-if-defined=cacosl \
    --export-if-defined=canonicalize \
    --export-if-defined=canonicalizef \
    --export-if-defined=canonicalizef32 \
    --export-if-defined=canonicalizef32x \
    --export-if-defined=canonicalizef64 \
    --export-if-defined=canonicalizef64x \
    --export-if-defined=canonicalizel \
    --export-if-defined=carg \
    --export-if-defined=cargf \
    --export-if-defined=cargf32 \
    --export-if-defined=cargf32x \
    --export-if-defined=cargf64 \
    --export-if-defined=cargf64x \
    --export-if-defined=cargl \
    --export-if-defined=casin \
    --export-if-defined=casinf \
    --export-if-defined=casinf32 \
    --export-if-defined=casinf32x \
    --export-if-defined=casinf64 \
    --export-if-defined=casinf64x \
    --export-if-defined=casinh \
    --export-if-defined=casinhf \
    --export-if-defined=casinhf32 \
    --export-if-defined=casinhf32x \
    --export-if-defined=casinhf64 \
    --export-if-defined=casinhf64x \
    --export-if-defined=casinhl \
    --export-if-defined=casinl \
    --export-if-defined=catan \
    --export-if-defined=catanf \
    --export-if-defined=catanf32 \
    --export-if-defined=catanf32x \
    --export-if-defined=catanf64 \
    --export-if-defined=catanf64x \
    --export-if-defined=catanh \
    --export-if-defined=catanhf \
    --export-if-defined=catanhf32 \
    --export-if-defined=catanhf32x \
    --export-if-defined=catanhf64 \
    --export-if-defined=catanhf64x \
    --export-if-defined=catanhl \
    --export-if-defined=catanl \
    --export-if-defined=cbrt \
    --export-if-defined=cbrtf \
    --export-if-defined=cbrtf32 \
    --export-if-defined=cbrtf32x \
    --export-if-defined=cbrtf64 \
    --export-if-defined=cbrtf64x \
    --export-if-defined=cbrtl \
    --export-if-defined=ccos \
    --export-if-defined=ccosf \
    --export-if-defined=ccosf32 \
    --export-if-defined=ccosf32x \
    --export-if-defined=ccosf64 \
    --export-if-defined=ccosf64x \
    --export-if-defined=ccosh \
    --export-if-defined=ccoshf \
    --export-if-defined=ccoshf32 \
    --export-if-defined=ccoshf32x \
    --export-if-defined=ccoshf64 \
    --export-if-defined=ccoshf64x \
    --export-if-defined=ccoshl \
    --export-if-defined=ccosl \
    --export-if-defined=ceil \
    --export-if-defined=ceilf \
    --export-if-defined=ceilf32 \
    --export-if-defined=ceilf32x \
    --export-if-defined=ceilf64 \
    --export-if-defined=ceilf64x \
    --export-if-defined=ceill \
    --export-if-defined=cexp \
    --export-if-defined=cexpf \
    --export-if-defined=cexpf32 \
    --export-if-defined=cexpf32x \
    --export-if-defined=cexpf64 \
    --export-if-defined=cexpf64x \
    --export-if-defined=cexpl \
    --export-if-defined=cimag \
    --export-if-defined=cimagf \
    --export-if-defined=cimagf32 \
    --export-if-defined=cimagf32x \
    --export-if-defined=cimagf64 \
    --export-if-defined=cimagf64x \
    --export-if-defined=cimagl \
    --export-if-defined=clog \
    --export-if-defined=clog10 \
    --export-if-defined=clog10f \
    --export-if-defined=clog10f32 \
    --export-if-defined=clog10f32x \
    --export-if-defined=clog10f64 \
    --export-if-defined=clog10f64x \
    --export-if-defined=clog10l \
    --export-if-defined=clogf \
    --export-if-defined=clogf32 \
    --export-if-defined=clogf32x \
    --export-if-defined=clogf64 \
    --export-if-defined=clogf64x \
    --export-if-defined=clogl \
    --export-if-defined=conj \
    --export-if-defined=conjf \
    --export-if-defined=conjf32 \
    --export-if-defined=conjf32x \
    --export-if-defined=conjf64 \
    --export-if-defined=conjf64x \
    --export-if-defined=conjl \
    --export-if-defined=copysign \
    --export-if-defined=copysignf \
    --export-if-defined=copysignf32 \
    --export-if-defined=copysignf32x \
    --export-if-defined=copysignf64 \
    --export-if-defined=copysignf64x \
    --export-if-defined=copysignl \
    --export-if-defined=cos \
    --export-if-defined=cosf \
    --export-if-defined=cosf32 \
    --export-if-defined=cosf32x \
    --export-if-defined=cosf64 \
    --export-if-defined=cosf64x \
    --export-if-defined=cosh \
    --export-if-defined=coshf \
    --export-if-defined=coshf32 \
    --export-if-defined=coshf32x \
    --export-if-defined=coshf64 \
    --export-if-defined=coshf64x \
    --export-if-defined=coshl \
    --export-if-defined=cosl \
    --export-if-defined=cpow \
    --export-if-defined=cpowf \
    --export-if-defined=cpowf32 \
    --export-if-defined=cpowf32x \
    --export-if-defined=cpowf64 \
    --export-if-defined=cpowf64x \
    --export-if-defined=cpowl \
    --export-if-defined=cproj \
    --export-if-defined=cprojf \
    --export-if-defined=cprojf32 \
    --export-if-defined=cprojf32x \
    --export-if-defined=cprojf64 \
    --export-if-defined=cprojf64x \
    --export-if-defined=cprojl \
    --export-if-defined=creal \
    --export-if-defined=crealf \
    --export-if-defined=crealf32 \
    --export-if-defined=crealf32x \
    --export-if-defined=crealf64 \
    --export-if-defined=crealf64x \
    --export-if-defined=creall \
    --export-if-defined=csin \
    --export-if-defined=csinf \
    --export-if-defined=csinf32 \
    --export-if-defined=csinf32x \
    --export-if-defined=csinf64 \
    --export-if-defined=csinf64x \
    --export-if-defined=csinh \
    --export-if-defined=csinhf \
    --export-if-defined=csinhf32 \
    --export-if-defined=csinhf32x \
    --export-if-defined=csinhf64 \
    --export-if-defined=csinhf64x \
    --export-if-defined=csinhl \
    --export-if-defined=csinl \
    --export-if-defined=csqrt \
    --export-if-defined=csqrtf \
    --export-if-defined=csqrtf32 \
    --export-if-defined=csqrtf32x \
    --export-if-defined=csqrtf64 \
    --export-if-defined=csqrtf64x \
    --export-if-defined=csqrtl \
    --export-if-defined=ctan \
    --export-if-defined=ctanf \
    --export-if-defined=ctanf32 \
    --export-if-defined=ctanf32x \
    --export-if-defined=ctanf64 \
    --export-if-defined=ctanf64x \
    --export-if-defined=ctanh \
    --export-if-defined=ctanhf \
    --export-if-defined=ctanhf32 \
    --export-if-defined=ctanhf32x \
    --export-if-defined=ctanhf64 \
    --export-if-defined=ctanhf64x \
    --export-if-defined=ctanhl \
    --export-if-defined=ctanl \
    --export-if-defined=daddl \
    --export-if-defined=ddivl \
    --export-if-defined=dfmal \
    --export-if-defined=dmull \
    --export-if-defined=drem \
    --export-if-defined=dremf \
    --export-if-defined=dreml \
    --export-if-defined=dsqrtl \
    --export-if-defined=dsubl \
    --export-if-defined=erf \
    --export-if-defined=erfc \
    --export-if-defined=erfcf \
    --export-if-defined=erfcf32 \
    --export-if-defined=erfcf32x \
    --export-if-defined=erfcf64 \
    --export-if-defined=erfcf64x \
    --export-if-defined=erfcl \
    --export-if-defined=erff \
    --export-if-defined=erff32 \
    --export-if-defined=erff32x \
    --export-if-defined=erff64 \
    --export-if-defined=erff64x \
    --export-if-defined=erfl \
    --export-if-defined=exp \
    --export-if-defined=exp10 \
    --export-if-defined=exp10f \
    --export-if-defined=exp10f32 \
    --export-if-defined=exp10f32x \
    --export-if-defined=exp10f64 \
    --export-if-defined=exp10f64x \
    --export-if-defined=exp10l \
    --export-if-defined=exp2 \
    --export-if-defined=exp2f \
    --export-if-defined=exp2f32 \
    --export-if-defined=exp2f32x \
    --export-if-defined=exp2f64 \
    --export-if-defined=exp2f64x \
    --export-if-defined=exp2l \
    --export-if-defined=expf \
    --export-if-defined=expf32 \
    --export-if-defined=expf32x \
    --export-if-defined=expf64 \
    --export-if-defined=expf64x \
    --export-if-defined=expl \
    --export-if-defined=expm1 \
    --export-if-defined=expm1f \
    --export-if-defined=expm1f32 \
    --export-if-defined=expm1f32x \
    --export-if-defined=expm1f64 \
    --export-if-defined=expm1f64x \
    --export-if-defined=expm1l \
    --export-if-defined=f32addf128 \
    --export-if-defined=f32addf32x \
    --export-if-defined=f32addf64 \
    --export-if-defined=f32addf64x \
    --export-if-defined=f32divf128 \
    --export-if-defined=f32divf32x \
    --export-if-defined=f32divf64 \
    --export-if-defined=f32divf64x \
    --export-if-defined=f32fmaf128 \
    --export-if-defined=f32fmaf32x \
    --export-if-defined=f32fmaf64 \
    --export-if-defined=f32fmaf64x \
    --export-if-defined=f32mulf128 \
    --export-if-defined=f32mulf32x \
    --export-if-defined=f32mulf64 \
    --export-if-defined=f32mulf64x \
    --export-if-defined=f32sqrtf128 \
    --export-if-defined=f32sqrtf32x \
    --export-if-defined=f32sqrtf64 \
    --export-if-defined=f32sqrtf64x \
    --export-if-defined=f32subf128 \
    --export-if-defined=f32subf32x \
    --export-if-defined=f32subf64 \
    --export-if-defined=f32subf64x \
    --export-if-defined=f32xaddf128 \
    --export-if-defined=f32xaddf64 \
    --export-if-defined=f32xaddf64x \
    --export-if-defined=f32xdivf128 \
    --export-if-defined=f32xdivf64 \
    --export-if-defined=f32xdivf64x \
    --export-if-defined=f32xfmaf128 \
    --export-if-defined=f32xfmaf64 \
    --export-if-defined=f32xfmaf64x \
    --export-if-defined=f32xmulf128 \
    --export-if-defined=f32xmulf64 \
    --export-if-defined=f32xmulf64x \
    --export-if-defined=f32xsqrtf128 \
    --export-if-defined=f32xsqrtf64 \
    --export-if-defined=f32xsqrtf64x \
    --export-if-defined=f32xsubf128 \
    --export-if-defined=f32xsubf64 \
    --export-if-defined=f32xsubf64x \
    --export-if-defined=f64addf128 \
    --export-if-defined=f64addf64x \
    --export-if-defined=f64divf128 \
    --export-if-defined=f64divf64x \
    --export-if-defined=f64fmaf128 \
    --export-if-defined=f64fmaf64x \
    --export-if-defined=f64mulf128 \
    --export-if-defined=f64mulf64x \
    --export-if-defined=f64sqrtf128 \
    --export-if-defined=f64sqrtf64x \
    --export-if-defined=f64subf128 \
    --export-if-defined=f64subf64x \
    --export-if-defined=f64xaddf128 \
    --export-if-defined=f64xdivf128 \
    --export-if-defined=f64xfmaf128 \
    --export-if-defined=f64xmulf128 \
    --export-if-defined=f64xsqrtf128 \
    --export-if-defined=f64xsubf128 \
    --export-if-defined=fabs \
    --export-if-defined=fabsf \
    --export-if-defined=fabsf32 \
    --export-if-defined=fabsf32x \
    --export-if-defined=fabsf64 \
    --export-if-defined=fabsf64x \
    --export-if-defined=fabsl \
    --export-if-defined=fadd \
    --export-if-defined=faddl \
    --export-if-defined=fdim \
    --export-if-defined=fdimf \
    --export-if-defined=fdimf32 \
    --export-if-defined=fdimf32x \
    --export-if-defined=fdimf64 \
    --export-if-defined=fdimf64x \
    --export-if-defined=fdiml \
    --export-if-defined=fdiv \
    --export-if-defined=fdivl \
    --export-if-defined=feclearexcept \
    --export-if-defined=fedisableexcept \
    --export-if-defined=feenableexcept \
    --export-if-defined=fegetenv \
    --export-if-defined=fegetexcept \
    --export-if-defined=fegetexceptflag \
    --export-if-defined=fegetmode \
    --export-if-defined=fegetround \
    --export-if-defined=feholdexcept \
    --export-if-defined=feraiseexcept \
    --export-if-defined=fesetenv \
    --export-if-defined=fesetexcept \
    --export-if-defined=fesetexceptflag \
    --export-if-defined=fesetmode \
    --export-if-defined=fesetround \
    --export-if-defined=fetestexcept \
    --export-if-defined=fetestexceptflag \
    --export-if-defined=feupdateenv \
    --export-if-defined=ffma \
    --export-if-defined=ffmal \
    --export-if-defined=finite \
    --export-if-defined=finitef \
    --export-if-defined=finitel \
    --export-if-defined=floor \
    --export-if-defined=floorf \
    --export-if-defined=floorf32 \
    --export-if-defined=floorf32x \
    --export-if-defined=floorf64 \
    --export-if-defined=floorf64x \
    --export-if-defined=floorl \
    --export-if-defined=fma \
    --export-if-defined=fmaf \
    --export-if-defined=fmaf32 \
    --export-if-defined=fmaf32x \
    --export-if-defined=fmaf64 \
    --export-if-defined=fmaf64x \
    --export-if-defined=fmal \
    --export-if-defined=fmax \
    --export-if-defined=fmaxf \
    --export-if-defined=fmaxf32 \
    --export-if-defined=fmaxf32x \
    --export-if-defined=fmaxf64 \
    --export-if-defined=fmaxf64x \
    --export-if-defined=fmaximum \
    --export-if-defined=fmaximum_mag \
    --export-if-defined=fmaximum_mag_num \
    --export-if-defined=fmaximum_mag_numf \
    --export-if-defined=fmaximum_mag_numf128 \
    --export-if-defined=fmaximum_mag_numf32 \
    --export-if-defined=fmaximum_mag_numf32x \
    --export-if-defined=fmaximum_mag_numf64 \
    --export-if-defined=fmaximum_mag_numf64x \
    --export-if-defined=fmaximum_mag_numl \
    --export-if-defined=fmaximum_magf \
    --export-if-defined=fmaximum_magf128 \
    --export-if-defined=fmaximum_magf32 \
    --export-if-defined=fmaximum_magf32x \
    --export-if-defined=fmaximum_magf64 \
    --export-if-defined=fmaximum_magf64x \
    --export-if-defined=fmaximum_magl \
    --export-if-defined=fmaximum_num \
    --export-if-defined=fmaximum_numf \
    --export-if-defined=fmaximum_numf128 \
    --export-if-defined=fmaximum_numf32 \
    --export-if-defined=fmaximum_numf32x \
    --export-if-defined=fmaximum_numf64 \
    --export-if-defined=fmaximum_numf64x \
    --export-if-defined=fmaximum_numl \
    --export-if-defined=fmaximumf \
    --export-if-defined=fmaximumf128 \
    --export-if-defined=fmaximumf32 \
    --export-if-defined=fmaximumf32x \
    --export-if-defined=fmaximumf64 \
    --export-if-defined=fmaximumf64x \
    --export-if-defined=fmaximuml \
    --export-if-defined=fmaxl \
    --export-if-defined=fmaxmag \
    --export-if-defined=fmaxmagf \
    --export-if-defined=fmaxmagf32 \
    --export-if-defined=fmaxmagf32x \
    --export-if-defined=fmaxmagf64 \
    --export-if-defined=fmaxmagf64x \
    --export-if-defined=fmaxmagl \
    --export-if-defined=fmin \
    --export-if-defined=fminf \
    --export-if-defined=fminf32 \
    --export-if-defined=fminf32x \
    --export-if-defined=fminf64 \
    --export-if-defined=fminf64x \
    --export-if-defined=fminimum \
    --export-if-defined=fminimum_mag \
    --export-if-defined=fminimum_mag_num \
    --export-if-defined=fminimum_mag_numf \
    --export-if-defined=fminimum_mag_numf128 \
    --export-if-defined=fminimum_mag_numf32 \
    --export-if-defined=fminimum_mag_numf32x \
    --export-if-defined=fminimum_mag_numf64 \
    --export-if-defined=fminimum_mag_numf64x \
    --export-if-defined=fminimum_mag_numl \
    --export-if-defined=fminimum_magf \
    --export-if-defined=fminimum_magf128 \
    --export-if-defined=fminimum_magf32 \
    --export-if-defined=fminimum_magf32x \
    --export-if-defined=fminimum_magf64 \
    --export-if-defined=fminimum_magf64x \
    --export-if-defined=fminimum_magl \
    --export-if-defined=fminimum_num \
    --export-if-defined=fminimum_numf \
    --export-if-defined=fminimum_numf128 \
    --export-if-defined=fminimum_numf32 \
    --export-if-defined=fminimum_numf32x \
    --export-if-defined=fminimum_numf64 \
    --export-if-defined=fminimum_numf64x \
    --export-if-defined=fminimum_numl \
    --export-if-defined=fminimumf \
    --export-if-defined=fminimumf128 \
    --export-if-defined=fminimumf32 \
    --export-if-defined=fminimumf32x \
    --export-if-defined=fminimumf64 \
    --export-if-defined=fminimumf64x \
    --export-if-defined=fminimuml \
    --export-if-defined=fminl \
    --export-if-defined=fminmag \
    --export-if-defined=fminmagf \
    --export-if-defined=fminmagf32 \
    --export-if-defined=fminmagf32x \
    --export-if-defined=fminmagf64 \
    --export-if-defined=fminmagf64x \
    --export-if-defined=fminmagl \
    --export-if-defined=fmod \
    --export-if-defined=fmodf \
    --export-if-defined=fmodf32 \
    --export-if-defined=fmodf32x \
    --export-if-defined=fmodf64 \
    --export-if-defined=fmodf64x \
    --export-if-defined=fmodl \
    --export-if-defined=fmul \
    --export-if-defined=fmull \
    --export-if-defined=frexp \
    --export-if-defined=frexpf \
    --export-if-defined=frexpf32 \
    --export-if-defined=frexpf32x \
    --export-if-defined=frexpf64 \
    --export-if-defined=frexpf64x \
    --export-if-defined=frexpl \
    --export-if-defined=fromfp \
    --export-if-defined=fromfpf \
    --export-if-defined=fromfpf32 \
    --export-if-defined=fromfpf32x \
    --export-if-defined=fromfpf64 \
    --export-if-defined=fromfpf64x \
    --export-if-defined=fromfpl \
    --export-if-defined=fromfpx \
    --export-if-defined=fromfpxf \
    --export-if-defined=fromfpxf32 \
    --export-if-defined=fromfpxf32x \
    --export-if-defined=fromfpxf64 \
    --export-if-defined=fromfpxf64x \
    --export-if-defined=fromfpxl \
    --export-if-defined=fsqrt \
    --export-if-defined=fsqrtl \
    --export-if-defined=fsub \
    --export-if-defined=fsubl \
    --export-if-defined=gamma \
    --export-if-defined=gamma_r \
    --export-if-defined=gammaf \
    --export-if-defined=gammaf_r \
    --export-if-defined=gammal \
    --export-if-defined=gammal_r \
    --export-if-defined=getpayload \
    --export-if-defined=getpayloadf \
    --export-if-defined=getpayloadf32 \
    --export-if-defined=getpayloadf32x \
    --export-if-defined=getpayloadf64 \
    --export-if-defined=getpayloadf64x \
    --export-if-defined=getpayloadl \
    --export-if-defined=hypot \
    --export-if-defined=hypotf \
    --export-if-defined=hypotf32 \
    --export-if-defined=hypotf32x \
    --export-if-defined=hypotf64 \
    --export-if-defined=hypotf64x \
    --export-if-defined=hypotl \
    --export-if-defined=ilogb \
    --export-if-defined=ilogbf \
    --export-if-defined=ilogbf32 \
    --export-if-defined=ilogbf32x \
    --export-if-defined=ilogbf64 \
    --export-if-defined=ilogbf64x \
    --export-if-defined=ilogbl \
    --export-if-defined=isinf \
    --export-if-defined=isinff \
    --export-if-defined=isinfl \
    --export-if-defined=isnan \
    --export-if-defined=isnanf \
    --export-if-defined=isnanl \
    --export-if-defined=j0 \
    --export-if-defined=j0f \
    --export-if-defined=j0f32 \
    --export-if-defined=j0f32x \
    --export-if-defined=j0f64 \
    --export-if-defined=j0f64x \
    --export-if-defined=j0l \
    --export-if-defined=j1 \
    --export-if-defined=j1f \
    --export-if-defined=j1f32 \
    --export-if-defined=j1f32x \
    --export-if-defined=j1f64 \
    --export-if-defined=j1f64x \
    --export-if-defined=j1l \
    --export-if-defined=jn \
    --export-if-defined=jnf \
    --export-if-defined=jnf32 \
    --export-if-defined=jnf32x \
    --export-if-defined=jnf64 \
    --export-if-defined=jnf64x \
    --export-if-defined=jnl \
    --export-if-defined=ldexp \
    --export-if-defined=ldexpf \
    --export-if-defined=ldexpf32 \
    --export-if-defined=ldexpf32x \
    --export-if-defined=ldexpf64 \
    --export-if-defined=ldexpf64x \
    --export-if-defined=ldexpl \
    --export-if-defined=lgamma \
    --export-if-defined=lgamma_r \
    --export-if-defined=lgammaf \
    --export-if-defined=lgammaf32 \
    --export-if-defined=lgammaf32_r \
    --export-if-defined=lgammaf32x \
    --export-if-defined=lgammaf32x_r \
    --export-if-defined=lgammaf64 \
    --export-if-defined=lgammaf64_r \
    --export-if-defined=lgammaf64x \
    --export-if-defined=lgammaf64x_r \
    --export-if-defined=lgammaf_r \
    --export-if-defined=lgammal \
    --export-if-defined=lgammal_r \
    --export-if-defined=llogb \
    --export-if-defined=llogbf \
    --export-if-defined=llogbf32 \
    --export-if-defined=llogbf32x \
    --export-if-defined=llogbf64 \
    --export-if-defined=llogbf64x \
    --export-if-defined=llogbl \
    --export-if-defined=llrint \
    --export-if-defined=llrintf \
    --export-if-defined=llrintf32 \
    --export-if-defined=llrintf32x \
    --export-if-defined=llrintf64 \
    --export-if-defined=llrintf64x \
    --export-if-defined=llrintl \
    --export-if-defined=llround \
    --export-if-defined=llroundf \
    --export-if-defined=llroundf32 \
    --export-if-defined=llroundf32x \
    --export-if-defined=llroundf64 \
    --export-if-defined=llroundf64x \
    --export-if-defined=llroundl \
    --export-if-defined=log \
    --export-if-defined=log10 \
    --export-if-defined=log10f \
    --export-if-defined=log10f32 \
    --export-if-defined=log10f32x \
    --export-if-defined=log10f64 \
    --export-if-defined=log10f64x \
    --export-if-defined=log10l \
    --export-if-defined=log1p \
    --export-if-defined=log1pf \
    --export-if-defined=log1pf32 \
    --export-if-defined=log1pf32x \
    --export-if-defined=log1pf64 \
    --export-if-defined=log1pf64x \
    --export-if-defined=log1pl \
    --export-if-defined=log2 \
    --export-if-defined=log2f \
    --export-if-defined=log2f32 \
    --export-if-defined=log2f32x \
    --export-if-defined=log2f64 \
    --export-if-defined=log2f64x \
    --export-if-defined=log2l \
    --export-if-defined=logb \
    --export-if-defined=logbf \
    --export-if-defined=logbf32 \
    --export-if-defined=logbf32x \
    --export-if-defined=logbf64 \
    --export-if-defined=logbf64x \
    --export-if-defined=logbl \
    --export-if-defined=logf \
    --export-if-defined=logf32 \
    --export-if-defined=logf32x \
    --export-if-defined=logf64 \
    --export-if-defined=logf64x \
    --export-if-defined=logl \
    --export-if-defined=lrint \
    --export-if-defined=lrintf \
    --export-if-defined=lrintf32 \
    --export-if-defined=lrintf32x \
    --export-if-defined=lrintf64 \
    --export-if-defined=lrintf64x \
    --export-if-defined=lrintl \
    --export-if-defined=lround \
    --export-if-defined=lroundf \
    --export-if-defined=lroundf32 \
    --export-if-defined=lroundf32x \
    --export-if-defined=lroundf64 \
    --export-if-defined=lroundf64x \
    --export-if-defined=lroundl \
    --export-if-defined=matherr \
    --export-if-defined=modf \
    --export-if-defined=modff \
    --export-if-defined=modff32 \
    --export-if-defined=modff32x \
    --export-if-defined=modff64 \
    --export-if-defined=modff64x \
    --export-if-defined=modfl \
    --export-if-defined=nan \
    --export-if-defined=nanf \
    --export-if-defined=nanf32 \
    --export-if-defined=nanf32x \
    --export-if-defined=nanf64 \
    --export-if-defined=nanf64x \
    --export-if-defined=nanl \
    --export-if-defined=nearbyint \
    --export-if-defined=nearbyintf \
    --export-if-defined=nearbyintf32 \
    --export-if-defined=nearbyintf32x \
    --export-if-defined=nearbyintf64 \
    --export-if-defined=nearbyintf64x \
    --export-if-defined=nearbyintl \
    --export-if-defined=nextafter \
    --export-if-defined=nextafterf \
    --export-if-defined=nextafterf32 \
    --export-if-defined=nextafterf32x \
    --export-if-defined=nextafterf64 \
    --export-if-defined=nextafterf64x \
    --export-if-defined=nextafterl \
    --export-if-defined=nextdown \
    --export-if-defined=nextdownf \
    --export-if-defined=nextdownf32 \
    --export-if-defined=nextdownf32x \
    --export-if-defined=nextdownf64 \
    --export-if-defined=nextdownf64x \
    --export-if-defined=nextdownl \
    --export-if-defined=nexttoward \
    --export-if-defined=nexttowardf \
    --export-if-defined=nexttowardl \
    --export-if-defined=nextup \
    --export-if-defined=nextupf \
    --export-if-defined=nextupf32 \
    --export-if-defined=nextupf32x \
    --export-if-defined=nextupf64 \
    --export-if-defined=nextupf64x \
    --export-if-defined=nextupl \
    --export-if-defined=pow \
    --export-if-defined=pow10 \
    --export-if-defined=pow10f \
    --export-if-defined=pow10l \
    --export-if-defined=powf \
    --export-if-defined=powf32 \
    --export-if-defined=powf32x \
    --export-if-defined=powf64 \
    --export-if-defined=powf64x \
    --export-if-defined=powl \
    --export-if-defined=remainder \
    --export-if-defined=remainderf \
    --export-if-defined=remainderf32 \
    --export-if-defined=remainderf32x \
    --export-if-defined=remainderf64 \
    --export-if-defined=remainderf64x \
    --export-if-defined=remainderl \
    --export-if-defined=remquo \
    --export-if-defined=remquof \
    --export-if-defined=remquof32 \
    --export-if-defined=remquof32x \
    --export-if-defined=remquof64 \
    --export-if-defined=remquof64x \
    --export-if-defined=remquol \
    --export-if-defined=rint \
    --export-if-defined=rintf \
    --export-if-defined=rintf32 \
    --export-if-defined=rintf32x \
    --export-if-defined=rintf64 \
    --export-if-defined=rintf64x \
    --export-if-defined=rintl \
    --export-if-defined=round \
    --export-if-defined=roundeven \
    --export-if-defined=roundevenf \
    --export-if-defined=roundevenf32 \
    --export-if-defined=roundevenf32x \
    --export-if-defined=roundevenf64 \
    --export-if-defined=roundevenf64x \
    --export-if-defined=roundevenl \
    --export-if-defined=roundf \
    --export-if-defined=roundf32 \
    --export-if-defined=roundf32x \
    --export-if-defined=roundf64 \
    --export-if-defined=roundf64x \
    --export-if-defined=roundl \
    --export-if-defined=scalb \
    --export-if-defined=scalbf \
    --export-if-defined=scalbl \
    --export-if-defined=scalbln \
    --export-if-defined=scalblnf \
    --export-if-defined=scalblnf32 \
    --export-if-defined=scalblnf32x \
    --export-if-defined=scalblnf64 \
    --export-if-defined=scalblnf64x \
    --export-if-defined=scalblnl \
    --export-if-defined=scalbn \
    --export-if-defined=scalbnf \
    --export-if-defined=scalbnf32 \
    --export-if-defined=scalbnf32x \
    --export-if-defined=scalbnf64 \
    --export-if-defined=scalbnf64x \
    --export-if-defined=scalbnl \
    --export-if-defined=setpayload \
    --export-if-defined=setpayloadf \
    --export-if-defined=setpayloadf32 \
    --export-if-defined=setpayloadf32x \
    --export-if-defined=setpayloadf64 \
    --export-if-defined=setpayloadf64x \
    --export-if-defined=setpayloadl \
    --export-if-defined=setpayloadsig \
    --export-if-defined=setpayloadsigf \
    --export-if-defined=setpayloadsigf32 \
    --export-if-defined=setpayloadsigf32x \
    --export-if-defined=setpayloadsigf64 \
    --export-if-defined=setpayloadsigf64x \
    --export-if-defined=setpayloadsigl \
    --export-if-defined=signgam \
    --export-if-defined=significand \
    --export-if-defined=significandf \
    --export-if-defined=significandl \
    --export-if-defined=sin \
    --export-if-defined=sincos \
    --export-if-defined=sincosf \
    --export-if-defined=sincosf32 \
    --export-if-defined=sincosf32x \
    --export-if-defined=sincosf64 \
    --export-if-defined=sincosf64x \
    --export-if-defined=sincosl \
    --export-if-defined=sinf \
    --export-if-defined=sinf32 \
    --export-if-defined=sinf32x \
    --export-if-defined=sinf64 \
    --export-if-defined=sinf64x \
    --export-if-defined=sinh \
    --export-if-defined=sinhf \
    --export-if-defined=sinhf32 \
    --export-if-defined=sinhf32x \
    --export-if-defined=sinhf64 \
    --export-if-defined=sinhf64x \
    --export-if-defined=sinhl \
    --export-if-defined=sinl \
    --export-if-defined=sqrt \
    --export-if-defined=sqrtf \
    --export-if-defined=sqrtf32 \
    --export-if-defined=sqrtf32x \
    --export-if-defined=sqrtf64 \
    --export-if-defined=sqrtf64x \
    --export-if-defined=sqrtl \
    --export-if-defined=tan \
    --export-if-defined=tanf \
    --export-if-defined=tanf32 \
    --export-if-defined=tanf32x \
    --export-if-defined=tanf64 \
    --export-if-defined=tanf64x \
    --export-if-defined=tanh \
    --export-if-defined=tanhf \
    --export-if-defined=tanhf32 \
    --export-if-defined=tanhf32x \
    --export-if-defined=tanhf64 \
    --export-if-defined=tanhf64x \
    --export-if-defined=tanhl \
    --export-if-defined=tanl \
    --export-if-defined=tgamma \
    --export-if-defined=tgammaf \
    --export-if-defined=tgammaf32 \
    --export-if-defined=tgammaf32x \
    --export-if-defined=tgammaf64 \
    --export-if-defined=tgammaf64x \
    --export-if-defined=tgammal \
    --export-if-defined=totalorder \
    --export-if-defined=totalorderf \
    --export-if-defined=totalorderf128 \
    --export-if-defined=totalorderf32 \
    --export-if-defined=totalorderf32x \
    --export-if-defined=totalorderf64 \
    --export-if-defined=totalorderf64x \
    --export-if-defined=totalorderl \
    --export-if-defined=totalordermag \
    --export-if-defined=totalordermagf \
    --export-if-defined=totalordermagf128 \
    --export-if-defined=totalordermagf32 \
    --export-if-defined=totalordermagf32x \
    --export-if-defined=totalordermagf64 \
    --export-if-defined=totalordermagf64x \
    --export-if-defined=totalordermagl \
    --export-if-defined=trunc \
    --export-if-defined=truncf \
    --export-if-defined=truncf32 \
    --export-if-defined=truncf32x \
    --export-if-defined=truncf64 \
    --export-if-defined=truncf64x \
    --export-if-defined=truncl \
    --export-if-defined=ufromfp \
    --export-if-defined=ufromfpf \
    --export-if-defined=ufromfpf32 \
    --export-if-defined=ufromfpf32x \
    --export-if-defined=ufromfpf64 \
    --export-if-defined=ufromfpf64x \
    --export-if-defined=ufromfpl \
    --export-if-defined=ufromfpx \
    --export-if-defined=ufromfpxf \
    --export-if-defined=ufromfpxf32 \
    --export-if-defined=ufromfpxf32x \
    --export-if-defined=ufromfpxf64 \
    --export-if-defined=ufromfpxf64x \
    --export-if-defined=ufromfpxl \
    --export-if-defined=y0 \
    --export-if-defined=y0f \
    --export-if-defined=y0f32 \
    --export-if-defined=y0f32x \
    --export-if-defined=y0f64 \
    --export-if-defined=y0f64x \
    --export-if-defined=y0l \
    --export-if-defined=y1 \
    --export-if-defined=y1f \
    --export-if-defined=y1f32 \
    --export-if-defined=y1f32x \
    --export-if-defined=y1f64 \
    --export-if-defined=y1f64x \
    --export-if-defined=y1l \
    --export-if-defined=yn \
    --export-if-defined=ynf \
    --export-if-defined=ynf32 \
    --export-if-defined=ynf32x \
    --export-if-defined=ynf64 \
    --export-if-defined=ynf64x \
    --export-if-defined=ynl \
    -o "$SYSROOT/lib/wasm32-wasi/libm.so" /home/lind/lind-wasm/src/glibc/build/csu/errno.o

# ./scripts/append_tls_relocs_export.sh "$SYSROOT/lib/wasm32-wasi/libm.so" "$SYSROOT/lib/wasm32-wasi/libm.so"

mkdir -p /home/lind/lind-wasm/lindfs/lib
cp "$SYSROOT/lib/wasm32-wasi/libm.so" /home/lind/lind-wasm/lindfs/lib/
